name: space-base
recipe: drupal8
proxy:
  mailhog:
    - mail.lemp.lndo.site
  solrserver:
    - solr.space-base.lndo.site:8983
services:
  appserver:
    xdebug: true
    build:
      - "mkdir /var/www/.platformsh && mkdir /var/www/.platformsh/bin"
      - "curl -fsSL -o /var/www/.platformsh/bin/platform https://github.com/platformsh/platformsh-cli/releases/download/v3.26.0/platform.phar"
      - "chmod ug+x /var/www/.platformsh/bin/platform"
    overrides:
          services:
            environment:
              MINK_DRIVER_ARGS: '["chrome", null, "http://chromedriver:4444/wd/hub"]'
              MINK_DRIVER_ARGS_WEBDRIVER: '["chrome", null, "http://chromedriver:4444/wd/hub"]'
              MINK_DRIVER_CLASS: 'Drupal\FunctionalJavascriptTests\DrupalSelenium2Driver'
              BEHAT_PARAMS: >-
                {"extensions":{"Behat\\MinkExtension":{"base_url":"http://nginx/"},"Drupal\\DrupalExtension":{"drush":{"root":"/app/web"}}}}
  chromedriver:
    type: compose
    services:
      image: robcherry/docker-chromedriver:latest
      expose:
        - "4444"
      environment:
        CHROMEDRIVER_WHITELISTED_IPS: ""
        CHROMEDRIVER_URL_BASE: "/wd/hub"
      security_opt:
        - seccomp:unconfined
      command: ["/usr/local/bin/supervisord", "-c", "/etc/supervisord.conf"] 
  solrserver:
    type: solr:6.6
    portforward: true
    core: drupal
    config:
      conf: .platform/solr-conf
  mailhog:
    type: mailhog
    hogfrom:
      - appserver    
    portforward: 1026    
tooling:
  platform:
    service: appserver
    description: Run Platform CLI commands
    cmd:
      - /var/www/.platformsh/bin/platform
    options:
      passthrough: true
  phplint:
    service: appserver
    cmd: /app/vendor/bin/phplint
  phpcs:
    service: appserver
    cmd: /app/vendor/bin/phpcs
  phpcbf:
    service: appserver
    cmd: /app/vendor/bin/phpcbf
  phpunit:
    service: appserver
    cmd: /app/vendor/bin/phpunit
  behat:
    service: appserver
    cmd: /app/vendor/bin/behat
  chromedriver:
    service: chromedriver
    description: "Run chromedriver commands."
config:
  via: nginx
  webroot: web
  database: mariadb:10.1
